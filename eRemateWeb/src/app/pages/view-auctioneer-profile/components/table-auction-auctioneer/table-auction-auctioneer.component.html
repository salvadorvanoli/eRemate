<div class="table-container" style="width: 1040px; margin: 0 auto; margin-bottom: 40px;">
  <div *ngIf="loading" class="flex justify-content-center my-3">
    <p-progressSpinner strokeWidth="4" [style]="{'width': '50px', 'height': '50px'}" />
  </div>

  <p-table
    #dt
    [value]="auctions"
    [rows]="5"
    [columns]="cols"
    [paginator]="auctions.length > 0"
    [globalFilterFields]="globalFilterFields"
    [tableStyle]="{ width: '100%', marginBottom: '1rem' }"
    [(selection)]="selectedAuction"
    selectionMode="single"
    [rowHover]="true"
    dataKey="id"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} elementos"
    [showCurrentPageReport]="auctions.length > 0"
    [loading]="loading"
    (selectionChange)="onSelectionChange()"
  >
    <ng-template pTemplate="caption">
      <div class="flex items-center" style="gap: 10px;">
        <!-- Barra de búsqueda -->
        <p-iconfield>
            <p-inputicon styleClass="pi pi-search" />
            <input pInputText type="text" (input)="onFilterGlobal($event)" placeholder="Buscar..." />
        </p-iconfield>
        
        <!-- Botón para agregar subasta (solo visible en la agenda) -->
        <p-button 
            *ngIf="viewType === 'schedule'"
            label="Agregar Subasta" 
            icon="pi pi-plus" 
            class="mr-2" 
            (onClick)="openNew()" 
            [style]="{'background-color': '#6334E3', 'border-color': '#6334E3'}" 
        />
      </div>
    </ng-template>
    
    <ng-template pTemplate="header">
      <tr style="background-color: rgba(0, 0, 0, 0.04);">
        <th *ngFor="let col of cols" [style.width]="'calc(84% / ' + cols.length + ')'" style="background-color: rgba(0, 0, 0, 0.04);">
          {{ col.header }}
        </th>
        <th style="width: 16%; background-color: rgba(0, 0, 0, 0.04);">Acciones</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-auction>
      <tr [pSelectableRow]="auction">
        <td [style.width]="'calc(84% / ' + cols.length + ')'" *ngFor="let col of cols">
          <ng-container [ngSwitch]="col.field">
            <ng-container *ngSwitchCase="'fechaInicioDisplay'">
              {{ auction.fechaInicioDisplay }}
            </ng-container>
            <ng-container *ngSwitchCase="'fechaCierreDisplay'">
              {{ auction.fechaCierreDisplay }}
            </ng-container>
            <ng-container *ngSwitchDefault>
              {{ auction[col.field] }}
            </ng-container>
          </ng-container>
        </td>
        
        <!-- Acciones diferentes según el tipo de vista -->
        <td style="width: 16%">
          <div class="flex gap-2 justify-center">
            <!-- Botones para la agenda de subastas -->
            <div *ngIf="viewType === 'schedule'">
              <p-button icon="pi pi-eye" severity="info" [rounded]="true" [outlined]="true" pTooltip="Ver detalles" />
              <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="cancelAuction(auction)" pTooltip="Cancelar subasta" />
            </div>
            
            <!-- Botones para las solicitudes de subastas -->
            <div *ngIf="viewType === 'requests'">
              <p-button icon="pi pi-check" severity="success" [rounded]="true" [outlined]="true" (click)="acceptAuction(auction)" pTooltip="Aceptar solicitud" />
              <p-button icon="pi pi-times" severity="danger" [rounded]="true" [outlined]="true" (click)="rejectAuction(auction)" pTooltip="Rechazar solicitud" />
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center p-4">
          <span *ngIf="viewType === 'schedule'">No hay subastas en su agenda</span>
          <span *ngIf="viewType === 'requests'">No hay solicitudes de subastas pendientes</span>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog [(visible)]="auctionDialog" [style]="{ width: '500px' }" header="Detalles de la Subasta" [modal]="true">
    <ng-template pTemplate="content">
      <div class="flex flex-col gap-4">
        <div>
          <label for="tipoSubasta" class="block font-bold mb-2">Tipo de Subasta</label>
          <input type="text" pInputText id="tipoSubasta" [(ngModel)]="auction.tipoSubasta" required autofocus />
          <small class="text-red-500" *ngIf="submitted && !auction.tipoSubasta?.trim()">El tipo de subasta es requerido.</small>
        </div>
        <div>
          <label for="fechaInicio" class="block font-bold mb-2">Fecha de Inicio</label>
          <input type="datetime-local" pInputText id="fechaInicio" [(ngModel)]="auction.fechaInicio" required />
          <small class="text-red-500" *ngIf="submitted && !auction.fechaInicio">La fecha de inicio es requerida.</small>
        </div>
        <div>
          <label for="fechaCierre" class="block font-bold mb-2">Fecha de Cierre</label>
          <input type="datetime-local" pInputText id="fechaCierre" [(ngModel)]="auction.fechaCierre" required />
          <small class="text-red-500" *ngIf="submitted && !auction.fechaCierre">La fecha de cierre es requerida.</small>
        </div>
        <div>
          <label for="ubicacion" class="block font-bold mb-2">Ubicación</label>
          <input type="text" pInputText id="ubicacion" [(ngModel)]="auction.ubicacion" required />
          <small class="text-red-500" *ngIf="submitted && !auction.ubicacion?.trim()">La ubicación es requerida.</small>
        </div>
        <div>
          <label for="rematadorEmail" class="block font-bold mb-2">Email del Rematador</label>
          <input type="email" pInputText id="rematadorEmail" [(ngModel)]="rematadorEmail" required />
          <small class="text-red-500" *ngIf="submitted && !rematadorEmail?.trim()">El email del rematador es requerido.</small>
          <small class="text-red-500" *ngIf="submitted && emailError">{{emailError}}</small>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-end gap-2">
        <p-button 
            label="Cancelar" 
            icon="pi pi-times" 
            (onClick)="hideDialog()" 
            [style]="{'background-color': '#000000', 'border-color': '#000000', 'color': '#FFFFFF'}" 
        />
        <p-button 
            label="Guardar" 
            icon="pi pi-check" 
            (onClick)="saveAuction()" 
            [style]="{'background-color': '#6334E3', 'border-color': '#6334E3'}" 
        />
      </div>
    </ng-template>
  </p-dialog>

  <p-confirmDialog [style]="{ width: '450px' }" />
</div>
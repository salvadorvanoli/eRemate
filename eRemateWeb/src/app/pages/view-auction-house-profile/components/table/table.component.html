<div class="table-container" style="width: 1040px; margin: 0 auto; margin-bottom: 40px;">
  <div *ngIf="loading" class="flex justify-content-center my-3">
    <p-progressSpinner strokeWidth="4" [style]="{'width': '50px', 'height': '50px'}" />
  </div>

  <p-table
    #dt
    [value]="products"
    [rows]="3"
    [columns]="cols"
    [paginator]="products.length > 0"
    [globalFilterFields]="globalFilterFields"
    [tableStyle]="{ width: '100%', marginBottom: '1rem' }"
    [(selection)]="selectedProducts"
    [rowHover]="true"
    dataKey="id"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} elementos"
    [showCurrentPageReport]="products.length > 0"
    [loading]="loading"
    styleClass="custom-paginator"
  >
    <ng-template pTemplate="caption">
        <div class="flex items-center" style="gap: 10px;">
            <p-iconfield>
                <p-inputicon styleClass="pi pi-search" />
                <input pInputText type="text" (input)="onFilterGlobal($event)" placeholder="Buscar..." />
            </p-iconfield>
            
            <p-button 
                label="Agregar Rematador" 
                icon="pi pi-user-plus" 
                class="mr-2" 
                (onClick)="openAssignDialog()" 
                [style]="{'background-color': '#6334E3', 'border-color': '#6334E3'}" 
            />
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr style="background-color: rgba(0, 0, 0, 0.04);">
            <th style="width: 5%; background-color: rgba(0, 0, 0, 0.04);">
                <p-tableHeaderCheckbox />
            </th>
            <th *ngFor="let col of cols" [style.width]="'calc(84% / ' + cols.length + ')'" style="background-color: rgba(0, 0, 0, 0.04);">
                {{ col.header }}
            </th>
            <th style="width: 11%; background-color: rgba(0, 0, 0, 0.04);">Acciones</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
        <tr>
            <td style="width: 5%">
                <p-tableCheckbox [value]="item" />
            </td>
            
            <td [style.width]="'calc(84% / ' + cols.length + ')'" *ngFor="let col of cols">
                {{ item[col.field] }}
            </td>
            
            <td style="width: 11%">
                <div class="flex gap-2 justify-center">
                    <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="removeRematador(item)" pTooltip="Eliminar rematador" />
                </div>
            </td>
        </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center p-4">
          No hay rematadores disponibles
        </td>
      </tr>
    </ng-template>
  </p-table>
  
  <p-dialog [(visible)]="productDialog" [style]="{ width: '450px' }" [header]="getDialogHeader()" [modal]="true">
    <ng-template pTemplate="content">
        <div class="flex flex-col gap-6">
            <div>
                <label for="nombre" class="block font-bold mb-3">Nombre</label>
                <input type="text" pInputText id="nombre" [(ngModel)]="product.nombre" required autofocus />
                <small class="text-red-500" *ngIf="submitted && !product.nombre">Nombre es requerido.</small>
            </div>
            <div>
                <label for="apellido" class="block font-bold mb-3">Apellido</label>
                <input type="text" pInputText id="apellido" [(ngModel)]="product.apellido" required />
                <small class="text-red-500" *ngIf="submitted && !product.apellido">Apellido es requerido.</small>
            </div>
            <div>
                <label for="numeroMatricula" class="block font-bold mb-3">Número de Matrícula</label>
                <input type="text" pInputText id="numeroMatricula" [(ngModel)]="product.numeroMatricula" />
            </div>
            <div>
                <label for="email" class="block font-bold mb-3">Email</label>
                <input type="email" pInputText id="email" [(ngModel)]="product.email" />
            </div>
            <div>
                <label for="telefono" class="block font-bold mb-3">Teléfono</label>
                <input type="text" pInputText id="telefono" [(ngModel)]="product.telefono" />
            </div>
            <div>
                <label for="direccionFiscal" class="block font-bold mb-3">Dirección Fiscal</label>
                <textarea id="direccionFiscal" pTextarea [(ngModel)]="product.direccionFiscal" rows="3" cols="20"></textarea>
            </div>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <p-button label="Cancelar" icon="pi pi-times" text (click)="hideDialog()" />
        <p-button label="Guardar" icon="pi pi-check" (click)="saveProduct()" />
    </ng-template>
  </p-dialog>
  
  <p-dialog [(visible)]="assignDialog" [style]="{ width: '450px' }" header="Agregar Rematador" [modal]="true" [closable]="false">
    <ng-template pTemplate="content">
        <!-- Spinner de carga durante la asignación -->
        <div *ngIf="loading" class="flex justify-content-center my-3">
            <p-progressSpinner strokeWidth="4" [style]="{'width': '50px', 'height': '50px'}" />
        </div>

        <div class="flex flex-col gap-4">
            <div>
                <label for="email" class="block font-bold mb-2">Email del Rematador</label>
                <input type="email" pInputText id="email" [(ngModel)]="rematadorEmail" required autofocus 
                       [class.ng-invalid]="emailSubmitted && !rematadorEmail.trim()" 
                       [class.ng-dirty]="emailSubmitted && !rematadorEmail.trim()" />
                <small class="text-red-500" *ngIf="emailSubmitted && !rematadorEmail?.trim()">El email es requerido.</small>
            </div>
            <p class="text-gray-600">Ingrese el email del rematador que desea agregar a su casa de remates.</p>
            <p class="text-sm text-gray-500">Nota: El rematador debe estar previamente registrado en el sistema.</p>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2">
            <p-button 
                label="Cancelar" 
                icon="pi pi-times" 
                (onClick)="hideAssignDialog()" 
                [style]="{'background-color': '#000000', 'border-color': '#000000', 'color': '#FFFFFF'}" 
            />
            <p-button 
                label="Agregar" 
                icon="pi pi-user-plus" 
                (onClick)="assignRematadorByEmail()" 
                [disabled]="loading" 
                [style]="{'background-color': '#6334E3', 'border-color': '#6334E3'}" 
            />
        </div>
    </ng-template>
  </p-dialog>

  <p-confirmDialog [style]="{ width: '450px' }" />
</div>

<style>
  /* Estilos para los botones de paginación */
  ::ng-deep .custom-paginator .p-paginator .p-paginator-pages .p-paginator-page.p-highlight {
    background-color: #9B85D6 !important;
    border-color: #9B85D6 !important;
    color: #ffffff !important;
  }

  ::ng-deep .custom-paginator .p-paginator-first:focus,
  ::ng-deep .custom-paginator .p-paginator-prev:focus, 
  ::ng-deep .custom-paginator .p-paginator-next:focus,
  ::ng-deep .custom-paginator .p-paginator-last:focus,
  ::ng-deep .custom-paginator .p-paginator-page:focus {
    box-shadow: 0 0 0 0.2rem rgba(155, 133, 214, 0.5) !important;
  }

  ::ng-deep .custom-paginator .p-paginator .p-paginator-pages .p-paginator-page:hover {
    background-color: rgba(155, 133, 214, 0.1) !important;
  }
</style>